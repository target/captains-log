(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[138],{4179:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return r},metadata:function(){return l},toc:function(){return s},default:function(){return m}});var n=a(2122),i=a(9756),o=(a(7294),a(3905)),r={},l={unversionedId:"configuration/base-config",id:"configuration/base-config",isDocsHomePage:!1,title:"Base Configuration",description:"There are two primary options for configuration:",source:"@site/docs/configuration/base-config.md",sourceDirName:"configuration",slug:"/configuration/base-config",permalink:"/captains-log/docs/configuration/base-config",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/configuration/base-config.md",version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Welcome To Captain's Log",permalink:"/captains-log/docs/intro"},next:{title:"Using Teams to Structure Output",permalink:"/captains-log/docs/configuration/teams"}},s=[{value:"Options",id:"options",children:[{value:"Example",id:"example",children:[]}]},{value:"Github Tag Ids",id:"github-tag-ids",children:[]}],p={toc:s};function m(e){var t=e.components,a=(0,i.Z)(e,["components"]);return(0,o.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"There are two primary options for configuration:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"use a configuration file (e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},".vela.yml"),",",(0,o.kt)("inlineCode",{parentName:"li"},".drone.yml"),", etc.) and create a build step with the configuration values required (listed below)."),(0,o.kt)("li",{parentName:"ul"},"place a ",(0,o.kt)("inlineCode",{parentName:"li"},".captains.yml")," file at the root of your directory. Place any required configuration in there. (",(0,o.kt)("strong",{parentName:"li"},"note"),", you will still need a ",(0,o.kt)("em",{parentName:"li"},"Captain's Log build step"),", it just will not have any of the configuration values listed there.)")),(0,o.kt)("p",null,"Both are usable, and at the same time. Any environment variable set (e.g. by your CI server) will overwrite any values in the ",(0,o.kt)("inlineCode",{parentName:"p"},".captains.yml"),"."),(0,o.kt)("p",null,"Suggested configuration would be to place secrets in your CI configuration, and then have all other Captain's Log configurations in the ",(0,o.kt)("inlineCode",{parentName:"p"},".captain.yml"),"."),(0,o.kt)("h2",{id:"options"},"Options"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Required Fields")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"github_owner")," - Owner of the the target repository. Example: ",(0,o.kt)("inlineCode",{parentName:"li"},"github.com/frank/cool_repo"),", ",(0,o.kt)("strong",{parentName:"li"},"frank")," would be the ",(0,o.kt)("em",{parentName:"li"},"owner")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"github_repo")," - Target repository name. Example: ",(0,o.kt)("inlineCode",{parentName:"li"},"github.com/frank/cool_repo"),", ",(0,o.kt)("strong",{parentName:"li"},"cool_repo")," would be the ",(0,o.kt)("em",{parentName:"li"},"repo"))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Required Secrets")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"GITHUB_TOKEN")," - secure github token used to fetch information on releases/tags (consider using a non-user/bot account)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"SLACK_TOKEN")," or ",(0,o.kt)("inlineCode",{parentName:"li"},"SLACK_URL")," - tokens/channel urls are used to send messages to the correct channels")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Optional Fields")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"enterprise_host")," - ",(0,o.kt)("strong",{parentName:"li"},"Required if")," you use Enterprise Github. This is where you would supply the custom domain. (e.g. ",(0,o.kt)("a",{parentName:"li",href:"https://git.myCompany.com"},"https://git.myCompany.com"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"/api/v3")," will be appended to this ",(0,o.kt)("strong",{parentName:"li"},"do not include it for this value"),")."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"jira_team_domain")," - ",(0,o.kt)("strong",{parentName:"li"},"Required if")," you use the Jira issue tracker. Namespace of the Jira your workspace (e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},"jira.myteamnamespace.com"),", ",(0,o.kt)("strong",{parentName:"li"},"myteamnamespace")," would be the value for this key)."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"github_tag_id")," - you can use this as regex to match on specific tags. Useful when your tags are not in chronological order (e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},"-rc0"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"-rc1"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"-release"),")."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"slack_channel"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"SLACK_URL")," - when using the API, you should use ",(0,o.kt)("inlineCode",{parentName:"li"},"slack_channel")," to specify which room you'd like to post to. When using ",(0,o.kt)("inlineCode",{parentName:"li"},"SLACK_URL")," you should ",(0,o.kt)("strong",{parentName:"li"},"not")," specify the room (i.e. ",(0,o.kt)("inlineCode",{parentName:"li"},"slack_channel"),") because the room is already a part of the incoming webhook. (",(0,o.kt)("a",{parentName:"li",href:"https://api.slack.com/incoming-webhooks"},"Setting Up A Webhook (e.g. SLACK_URL)"),", ",(0,o.kt)("a",{parentName:"li",href:"https://api.slack.com/docs/token-types#verification"},"Setting Up A Slack Token"),")"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"teams")," - a list of teams which allows you to organize the output of Captain's Log into meaningful chunks. (more below)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"slack_message_heading")," - you can provide a custom heading for the slack message that is posted, when using this field."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"github_pr_text")," - you can provide custom text that will be inserted into the PR comment when a release is completed."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"github_skip_pr_comment")," - you can skip the PR comment on release by setting this field to ",(0,o.kt)("inlineCode",{parentName:"li"},"true"),".")),(0,o.kt)("h3",{id:"example"},"Example"),(0,o.kt)("h4",{id:"velayml"},".vela.yml"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"image: target/captains-log:1\npull: true\nsecrets: [GITHUB_TOKEN, SLACK_URL]\nparameters:\n  github_owner: target\n  github_repo: captains-log\n  github_tag_id: 'v([0-9]+-release)$'\n  enterprise_host: https://git.myteam.com\n  jira_team_domain: myteamnamespace\n  teams: ...\n")),(0,o.kt)("h4",{id:"droneyml"},".drone.yml"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"image: target/captains-log:1\npull: true\nsecrets:\n  - source: GITHUB_TOKEN\n    target: GITHUB_TOKEN\n  - source: SLACK_URL\n    target: SLACK_URL\ngithub_owner: target\ngithub_repo: captains-log\ngithub_tag_id: 'v([0-9]+-release)$'\nenterprise_host: https://git.myteam.com\njira_team_domain: myteamnamespace\nteams: ...\n")),(0,o.kt)("h4",{id:"captainsyml"},".captains.yml"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"image: target/captains-log:1\npull: true\ngithub_token: <token>\nslack_url: <slack_url>\ngithub_owner: target\ngithub_repo: captains-log\ngithub_tag_id: 'v([0-9]+-release)$'\nenterprise_host: https://git.myteam.com\njira_team_domain: myteamnamespace\nteams: ... # see teams configuration below\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"NOTE"),": Allthough you ",(0,o.kt)("em",{parentName:"p"},"can")," provide your ",(0,o.kt)("inlineCode",{parentName:"p"},"github_token")," and/or ",(0,o.kt)("inlineCode",{parentName:"p"},"slack_token/url")," (which can ",(0,o.kt)("em",{parentName:"p"},"ease")," testing locally), it is advised that you do ",(0,o.kt)("strong",{parentName:"p"},"NOT")," check these tokens into source control. You should always use secrets where applicable."),(0,o.kt)("h2",{id:"github-tag-ids"},"Github Tag Ids"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Example of ",(0,o.kt)("inlineCode",{parentName:"strong"},"github_tag_id"))),(0,o.kt)("p",null,"Some repositories use release candidates, so the format for releasing will look something like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"v2-release\nv2-rc1\nv2-rc0\nv1-release\n")),(0,o.kt)("p",null,"In order to compare against the right tag, you'll want to target the unique identifier. In this example, the ",(0,o.kt)("inlineCode",{parentName:"p"},"tag_id")," used will be a regex matching on numbers and ",(0,o.kt)("inlineCode",{parentName:"p"},"-release"),"."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"yaml")," for the plugin would look something like this"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"github_tag_id: 'v([0-9]+-release)$'\n")))}m.isMDXComponent=!0}}]);